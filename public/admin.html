<!DOCTYPE html>
<html>
<head>
  <title>Area Admin</title>
</head>
<body>

<h2>Area Admin</h2>

<button onclick="logout()">Logout</button>

<h3>Crea Disponibilità Professore</h3>

<select id="professoreSelect"></select>

<select id="giorno">
  <option value="2026-02-23">Lunedì</option>
  <option value="2026-02-24">Martedì</option>
  <option value="2026-02-25">Mercoledì</option>
  <option value="2026-02-26">Giovedì</option>
  <option value="2026-02-27">Venerdì</option>
</select>

<input type="time" id="ora_inizio">
<input type="time" id="ora_fine">

<button onclick="creaDisponibilita()">Salva</button>

<p id="msg"></p>

<script>

async function caricaProfessori() {

  const res = await fetch("/api/professori", {
    headers: {
      Authorization: "Bearer " + localStorage.getItem("accessToken")
    }
  });

  const professori = await res.json();

  const select = document.getElementById("professoreSelect");
  select.innerHTML = "";

  professori.forEach(p => {
    const option = document.createElement("option");
    option.value = p.id;
    option.textContent = p.nome;
    select.appendChild(option);
  });
}

async function creaDisponibilita() {

  const professore_id = document.getElementById("professoreSelect").value;
  const giorno = document.getElementById("giorno").value;
  const ora_inizio = document.getElementById("ora_inizio").value;
  const ora_fine = document.getElementById("ora_fine").value;

  const res = await fetch("/api/crea-disponibilita", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("accessToken")
    },
    body: JSON.stringify({
      professore_id,
      giorno,
      ora_inizio,
      ora_fine
    })
  });

  const data = await res.json();

  if (res.ok) {
    document.getElementById("msg").innerText = "Disponibilità creata!";
  } else {
    document.getElementById("msg").innerText = data.error;
  }
}

function logout() {
  localStorage.clear();
  window.location.href = "/login.html";
}

caricaProfessori();

</script>

</body>
</html>